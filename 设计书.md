# 分布式存储系统设计书

## 类图

```


+--------------------+
|     KVServer       |
|--------------------|
| + start()          |
| + stop()           |
| + handleRequest()  |
+----------+---------+
           |
           v
+--------------------+
|   RequestRouter    |
|--------------------|
| + route(key)       |  --------->
| + forward()        |
+----------+---------+
           |
           v
+----------------------------+
|      ShardManager          |
|----------------------------|
| + getShard(key)            |
| + splitShard()             |
| + migrateShard()           |
+----------+-----------------+
           |
           v
+----------------------------+
|          Shard             |
|----------------------------|
| shard_id                   |
| key_range                  |
| replicas                   |
|----------------------------|
| + get()                    |
| + put()                    |
+----------+-----------------+
           |
           v
+----------------------------+
|       RaftNode             |
|----------------------------|
| + proposeLog()             |
| + isLeader()               |
| + transferLeader()         |
+----------+-----------------+
           |
           v
+----------------------------+
|     RaftLog / StateMachine |
+----------------------------+
           |
           v
+----------------------------+
|      KVEngine (LSM)        |
|----------------------------|
| + get()                    |
| + put()                    |
| + delete()                 |
+----------+-----------------+
           |
           v
+----------------------------+
|    MemTable / SSTable      |
|    WAL / Compaction        |
+----------------------------+

```
